import * as R from 'ramda'
import React from 'react'
import {connect} from 'react-redux'
import {Link} from 'react-router-dom'
import {
    getBasketPhonesWithCount,
    getTotalPrice
    
} from 'selectors'
import {removePhoneFromBasket, cleanBasket,basketCheckout,addPhoneToBasket,delPhoneToBasket} from 'actions'

const Basket = (state) => {
    const {
        totalPrice,
        addPhoneToBasket,
        delPhoneToBasket,
        phones,
        removePhoneFromBasket,
        cleanBasket,
        basketCheckout
    } = state

    //  console.log('phones', phones)
    var isBasketEmpty = R.isEmpty(phones)
    // var serialObj = JSON.stringify(phones); //сериализуем его

    // if (!isBasketEmpty) {localStorage.setItem("myKey", serialObj)}
     
// window.onload = function(state) {
//   var loaded = sessionStorage.getItem('loaded');
//   if(loaded) {  
   
//     reloaded()
   
//     // rebasket(state)

   
//     // delete localStorage["myKey"]
    
//   } else {
//     sessionStorage.setItem('loaded', true);
//   }
// }



    const renderContent = () => (
        
        <div>
            { isBasketEmpty && <div>Your shopping cart is empty!</div> }
            
            { !isBasketEmpty &&
            <div className='table-responsive'>
                <table className='table-bordered table-striped table-condensed cf'>
                    <tbody>
                        {phones.map((phone,index) => (
                            <tr
                                className='item-checkout'
                                key={index}
                            >
                                <td className='first-column-checkout'>
                                    <img className='img-thumbnail'
                                         src={phone.image}
                                         alt={phone.name}
                                    />
                                </td>
                                <td>{phone.name}</td>
                                <td>${phone.price}</td>
                                <td>{phone.count}</td>
                                <td>
                                    <span 
                                    onClick={()=> addPhoneToBasket(phone.id)}
                                    >
                                        <i className="bi bi-file-earmark-minus">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" className="bi bi-file-plus" viewBox="0 0 16 16">
                                                <path fillRule="evenodd" d="M4 0h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2zm0 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H4z"/>
                                                <path fillRule="evenodd" d="M8 5.5a.5.5 0 0 1 .5.5v1.5H10a.5.5 0 0 1 0 1H8.5V10a.5.5 0 0 1-1 0V8.5H6a.5.5 0 0 1 0-1h1.5V6a.5.5 0 0 1 .5-.5z"/>
                                        </svg>
                                        </i>
                                     
                                    </span>
                                </td>
                                <td>
                                    <span 
                                    onClick={()=> delPhoneToBasket(phone.id)}
                                    >
                                        <i className="bi bi-file-earmark-minus">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" className="bi bi-file-earmark-minus" viewBox="0 0 16 16">
                                            <path d="M4 0h5.5v1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h1V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2z"/>
                                            <path d="M9.5 3V0L14 4.5h-3A1.5 1.5 0 0 1 9.5 3z"/>
                                            <path fillRule="evenodd" d="M5.5 9a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1H6a.5.5 0 0 1-.5-.5z"/>
                                        </svg>
                                        </i>
                                      
                                    </span>
                                </td>
                                <td>
                                    <span className='delete-cart'
                                    onClick={()=> removePhoneFromBasket(phone.id)}
                                    ></span>
                                </td>

                            </tr>
                        ))}
                    </tbody>

                </table>
            </div>
                }
           
            { 
                !isBasketEmpty &&
                <div className='row'>
                    <div className='pull-right total-user-checkout'>
                        <b>Total:</b>
                        ${totalPrice}

                     </div>

                </div>
            
            } 
            
        </div>

    )

    const renderSidebar = ()=> (
        <div>
            <Link
                to='/'
                className='btn btn-info'
            >
                <span className='glyphicon glyphicon-info-sign'></span>
                <span>Continue shopping!</span>
                </Link>
                {(!isBasketEmpty) &&
                <div>
                    <button
                        onClick={cleanBasket}
                        className='btn btn-danger'
                    >
                        <span className='glyphicon glyphicon-trash'> Clean basket!!!</span>
                    </button>
                    <button
                        className='btn btn-success'
                        onClick={() => basketCheckout(phones)}
                    >
                        <span className='glyphicon glyphicon-envelope'>
                             Checkout
                        </span>
                    </button>
                    
                </div>
                }
        </div>
    )

    return (
        <div className='view-container'>
        <div className='container'>
            <div className='row'>
                <div className='col-md-9'>
                    {renderContent()}
                </div>
                <div className='col-md-3 btn-user-checkout'>
                    {renderSidebar()}
                </div>

            </div>

        </div>

    </div>
    )
}

const mapStateToProps = (state) => {

    return {
        phones:getBasketPhonesWithCount(state),
        totalPrice: getTotalPrice(state)
       
       
    }
}

const mapDispatchToProps = {
    
        removePhoneFromBasket,
        cleanBasket,
        basketCheckout,
        addPhoneToBasket,
        delPhoneToBasket
   
}

export default connect(mapStateToProps, mapDispatchToProps)(Basket)